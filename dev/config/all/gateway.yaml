version: dev
name: gateway
deployment:
  gateway: # load generator specific
    virtualUsers: 3
    duration: 60
adapters:
# grpc secondary adapters
- server:
    action: read
    variant: rest
    route: grpc
    weight: 1 # load generator specific
  steps:
  - adapter:
      invocation:
        variant: grpc
        service: grpcserver
        action: simpleRpc
        route: get
  - adapter:
      invocation:
        variant: grpc
        service: grpcserver
        action: clientStream
        route: get
  - adapter:
      invocation:
        variant: grpc
        service: grpcserver
        action: serverStream
        route: get
  - adapter:
      invocation:
        variant: grpc
        service: grpcserver
        action: biStream
        route: get

# http secondary adapters
- server:
    action: read
    variant: rest
    route: httprest
    weight: 1 # load generator specific
  steps:
  - adapter:
      invocation:
        variant: rest
        service: chain1
        action: read
        route: get
  - adapter:
      invocation:
        variant: rest
        service: chain1
        action: write
        route: post
        payload: large

# mongo secondary adapter
- server:
    action: read
    variant: rest
    route: mongo
    weight: 1 # load generator specific
  steps:
  - adapter:
      repository:
        name: mongorepo
        variant: mongo
        action: read
        payload: small
  - adapter:
      repository:
        name: mongorepo
        variant: mongo
        action: write
        payload: large

# redis secondary adapters
- server:
    action: read
    variant: rest
    route: redis
    weight: 1 # load generator specific
  steps:
  - adapter:
      repository:
        name: redisrepo
        variant: redis
        action: read
        payload: small
  - adapter:
      stressor:
        name: cpu
        variant: cpu
        duration: 10ms
        payload: small
  - adapter:
      repository:
        name: redisrepo
        variant: redis
        action: write
        payload: large

# kafka secondary adapter
- server:
    action: read
    variant: rest
    route: produce
    weight: 1 # load generator specific
  steps:
  - adapter:
      producer:
        variant: kafka
        topic: topic1
